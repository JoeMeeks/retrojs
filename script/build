#!/bin/sh

source ~/emsdk_portable/emsdk_set_env.sh

em++ -std=c++11 -c libretro.emscripten.cpp -o libretro.emscripten.bc -O3

for core in core/*
do
  emcc libretro.emscripten.bc `find $core -name '*.bc' -print` --bind \
    --memory-init-file 0 -O3 --js-library glue.js \
    -o $core/index.js -s ALLOW_MEMORY_GROWTH=1 -s RESERVED_FUNCTION_POINTERS=20 \
    -s EXPORTED_FUNCTIONS=@exports.json -s SHELL_FILE="'`pwd`/shell.js'"
done
